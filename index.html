<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Document</title>
        <link rel="stylesheet" href="style.css" />
        <script src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"></script>
    </head>
    <body>
        <header>
            <div class="header">
                동물상 테스트
            </div>
        </header>

        <script
            class="jsbin"
            src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"
        ></script>
        <div class="file-upload">
            <div class="image-upload-wrap">
                <input
                    class="file-upload-input"
                    type="file"
                    onchange="readURL(this);"
                    accept="image/*"
                />
                <div class="drag-text">
                    <img src="img/upload.png" class="upload" />
                </div>
            </div>
            <div class="file-upload-content">
                <img class="file-upload-image" id="face-image" src="#" alt="your image" />
                <div id="loading" class="animated bounce">
                <div class="spinner" role="status">
                    <i class="fas fa-spinner"></i>
                    <span class="sr-only">Loading...</span>
                </div>
                <p class="text-center">AI가 당신의 동물상을 분석중입니다.</p>
            </div>
                <div class="result-messege"></div>
                <div class="result-descr"></div>
                <div class="result-celeb"></div>
                <div class="result-image"></div>
                <div id="label-container"></div>
                <div class="image-title-wrap">
                    <button type="button" onclick="window.location.reload();" class="remove-image">
                        <span class="try-again">다시 해보기~</span>
                    </button>
                </div>
            </div>
        </div>
        <div id="webcam-container"></div>

        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
        <script>
            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $('.image-upload-wrap').hide();
                        $('.file-upload-image').attr('src', e.target.result);
                        $('.file-upload-content').show();
                        $('.image-title').html(input.files[0].name);
                    };
                    reader.readAsDataURL(input.files[0]);
                    init().then(() => {
                        console.log('hello');
                        predict();
                        $('#loading').hide();
                    });
                } else {
                    removeUpload();
                }
            }
            function removeUpload() {
                $('.file-upload-input').replaceWith($('.file-upload-input').clone());
                $('.file-upload-content').hide();
                $('.image-upload-wrap').show();
            }
            $('.image-upload-wrap').bind('dragover', function () {
                $('.image-upload-wrap').addClass('image-dropping');
            });
            $('.image-upload-wrap').bind('dragleave', function () {
                $('.image-upload-wrap').removeClass('image-dropping');
            });
        </script>
        <script type="text/javascript">
            // More API functions here:
            // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image

            // the link to your model provided by Teachable Machine export panel
            const URL = 'https://teachablemachine.withgoogle.com/models/JyIpdnoVH/';

            let model, webcam, labelContainer, maxPredictions;

            // Load the image model and setup the webcam
            async function init() {
                const modelURL = URL + 'model.json';
                const metadataURL = URL + 'metadata.json';

                // load the model and metadata
                // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
                // or files from your local hard drive
                // Note: the pose library adds "tmImage" object to your window (window.tmImage)
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();
                labelContainer = document.getElementById('label-container');
                for (let i = 0; i < maxPredictions; i++) {
                    // and class labels
                    labelContainer.appendChild(document.createElement('div'));
                }
            }

            // run the webcam image through the image model
            async function predict() {
                // predict can take in an image, video or canvas html element
                var image = document.getElementById('face-image');
                const prediction = await model.predict(image, false);
                prediction.sort((a, b) => parseFloat(b.probability) - parseFloat(a.probability));
                console.log(prediction[0].className);
                var resultMessege;
                var resultImage;
                var resultDescription;
                var resultCeleb;
                /* random puppy*/
                var randomPuppy = [
                    'img/puppy/iu.jpg',
                    'img/puppy/boa2.jpg',
                    'img/puppy/hanjimin.jpg',
                    'img/puppy/chaesubin.jpg',
                ];
                function getImgPuppy() {
                    var img = '<img src="';
                    var randomIndex = Math.floor(Math.random() * randomPuppy.length);
                    img += randomPuppy[randomIndex];
                    img += '" alt="Some alt text" style="width:100%;"/>';
                    return img;
                }
                //random fox//
                var randomFox = [
                    'img/fox/kyoungri.jpg',
                    'img/fox/kyoungri2.jpg',
                    'img/fox/kimlove.jpg',
                    'img/fox/kimlove2.jpg',
                ];
                function getImgFox() {
                    var img = '<img src="';
                    var randomIndex = Math.floor(Math.random() * randomFox.length);
                    img += randomFox[randomIndex];
                    img += '" alt="Some alt text" style="width:100%;"/>';
                    return img;
                }
                //random deer//
                var randomDeer = [
                    'img/deer/yoona.jpg',
                    'img/deer/goara2.jpg',
                    'img/deer/tzuy.jpg',
                    'img/deer/leeyounhee.jpg',
                ];
                function getImgDeer() {
                    var img = '<img src="';
                    var randomIndex = Math.floor(Math.random() * randomDeer.length);
                    img += randomDeer[randomIndex];
                    img += '" alt="Some alt text" style="width:100%;"/>';
                    return img;
                }
                //random dfox//
                var randomDfox = [
                    'img/desertfox/jisu.jpg',
                    'img/desertfox/jisu2.jpg',
                    'img/desertfox/jenny.jpg',
                    'img/desertfox/sana.jpg',
                ];
                function getImgDfox() {
                    var img = '<img src="';
                    var randomIndex = Math.floor(Math.random() * randomDfox.length);
                    img += randomDfox[randomIndex];
                    img += '" alt="Some alt text" style="width:100%;"/>';
                    return img;
                }
                //random cat//
                 var randomCat = [
                    'img/cat/sohee.jpg',
                    'img/cat/hanyeseul.jpg',
                    'img/cat/chayeryun.jpg',
                    'img/cat/yooinyoung.jpg',
                ];
                function getImgCat() {
                    var img = '<img src="';
                    var randomIndex = Math.floor(Math.random() * randomCat.length);
                    img += randomCat[randomIndex];
                    img += '" alt="Some alt text" style="width:100%;"/>';
                    return img;
                }
                //random rabbit//
                 var randomRabbit = [
                    'img/rabbit/suzy.png',
                    'img/rabbit/nayeon.png',
                    'img/rabbit/irine.png',
                    'img/rabbit/rosi.png',
                ];
                function getImgRabbit() {
                    var img = '<img src="';
                    var randomIndex = Math.floor(Math.random() * randomRabbit.length);
                    img += randomRabbit[randomIndex];
                    img += '" alt="Some alt text" style="width:100%;"/>';
                    return img;
                }
                var ranPuppy = getImgPuppy();
                var ranFox = getImgFox();
                var ranDeer = getImgDeer();
                var ranDfox = getImgDfox();
                var ranCat = getImgCat();
                var ranRabbit = getImgRabbit();
                switch (prediction[0].className) {
                    case 'puppy':
                        resultMessege = '강아지상';
                        resultImage = ranPuppy;
                        resultDescription = '동그란 눈에 사랑스러운 매력을 가진 당신, 누가 봐도 너무나도 사랑스러운 분이시네요!';
                        resultCeleb = '강아지상 연예인 : 박보영, 아이유, 조보아, 채수빈, 한지민, etc..'
                        /*귀엽고 사랑스러운 매력의 강아지상*/
                        break;
                    case 'fox':
                        resultMessege = '여우상';
                        resultImage = ranFox;
                        resultDescription = '치명적인 눈빛의 소유자! 상대가 그 누구든 전부 홀릴수 있는 치명적인 당신!';
                        resultCeleb = '여우상 연예인 : 경리, 김사랑, etc..';
                        break;
                    case 'deer':
                        resultMessege = '사슴상';
                        resultImage = ranDeer;
                        resultDescription = '가녀린 사슴을 닮은 당신, 청순한 매력으로 모두를 홀리시겠네요!';
                        resultCeleb = '사슴상 연예인 : 윤아, 고아라, 이연희, 쯔위, etc..';
                        /*보호 본능을 자극하는 사슴상*/
                        break;
                    case 'desert fox':
                        resultMessege = '사막여우상';
                        resultImage = ranDfox;
                        resultDescription = '귀여우면서도 한편으론 치명적인 매력을 가진 분이시네요!';
                        resulCeleb = '사막여우상 연예인 : 지수, 제니, etc..';
                        break;
                    case 'rabbit':
                        resultMessege = '토끼상';
                        resultImage = ranRabbit;
                        resultDescription = '누가 봐도 귀엽고 사랑스러우시네요!';
                        resultCeleb = '토끼상 연예인 : 수지, 나연, 로시, 아이린, etc..';
                        /*발랄하고 생기 넘치는 토끼상*/
                        break;
                    case 'cat':
                        resultMessege = '고양이상';
                        resultImage = ranCat;
                        resultDescription = '도도한 매력을 지닌, 사랑할수 밖에 없는 당신!';
                        resultCeleb = '고양이상 연예인 : 안소희, 한예슬, 유인영, 차예련, etc..';
                        /*우아하고 도회적인 이미지의 고양이상*/
                        break;
                    default:
                        resultMessege = '알수없음';
                }
                $('.result-messege').html(resultMessege);
                $('.result-image').html(resultImage);
                $('.result-descr').html(resultDescription);
                $('.result-celeb').html(resultCeleb);
            }
        </script>
    </body>
</html>