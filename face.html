<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Document</title>
        <link rel="stylesheet" href="style.css" />
        <script src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"></script>
        <!-- Go to www.addthis.com/dashboard to customize your tools -->
        <script
            type="text/javascript"
            src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5f266097864de941"
        ></script>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.1/js/bootstrap.min.js" integrity="sha384-XEerZL0cuoUbHE4nZReLT7nx9gQrQreJekYhJD9WNWhH8nEW+0c5qq7aIo2Wl30J" crossorigin="anonymous"></script>
    </head>
    <body>
        <header class="header">
            <div class="menu">
                <input type="checkbox" id="menuicon" />
                <label for="menuicon">
                    <span></span>
                    <span></span>
                    <span></span>
                </label>
                <div class="sidebar">
                    <ul>
                        <li><a href="index.html">동물상</a></li>
                        <li><a href="celeb.html">닮은꼴</a></li>
                        <li><a href="face.html">얼굴평가</a></li>
                    </ul>
                </div>
            </div>
            <div class="header-logo">
                <a href="index.html"> <img src="img/leaf.png" class="logo-img" /></a>
            </div>
            <div class="header-title">
                얼굴평가 by AI
            </div>
        </header>
<div class="description">
    인공지능이 평가해주는 얼굴 순위입니다.
    <div class="subdescr">
        사진을 업로드 하시면 인공지능이 대한민국 상위 몇프로인지 판별해드립니다!<br>
        (재미로 하는거니 혹시라도 상처받지 마세요~)
    </div>
    <div class="warning">
        (업로드 하신 사진은 어떠한 경우로도 저장되거나 수집되지 않습니다.)
    </div>
        </div>
        <script
            class="jsbin"
            src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"
        ></script>
        <div class="file-upload">
            <div class="image-upload-wrap">
                <input
                    class="file-upload-input"
                    type="file"
                    onchange="readURL(this);"
                    accept="image/*"
                />
                <div class="drag-text">
                    <img src="img/upload.png" class="upload" />
                </div>
            </div>
            <div class="file-upload-content">
                <img class="file-upload-image" id="face-image" src="#" alt="your image" />
                <div id="loading" class="animated bounce">
                    <div class="spinner" role="status">
                        <i class="fas fa-spinner"></i>
                        <span class="sr-only">Loading...</span>
                    </div>
                    <p class="text-center">AI가 당신의 얼굴을 분석중입니다.</p>
                </div>
                <div id="label-container"></div>
                <div class="result-messege"></div>
                <div class="result-descr"></div>

                <div class="image-title-wrap">
                    <button type="button" onclick="window.location.reload();" class="remove-image">
                        <span class="try-again">다시 해보기~</span>
                    </button>
                </div>

                
            </div>
            <!-- Go to www.addthis.com/dashboard to customize your tools -->
                <div class="addthis_inline_share_toolbox_bqaa" style="text-align:center;"></div>
        </div>
        

        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
        <script>
            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        $('.image-upload-wrap').hide();
                        $('.file-upload-image').attr('src', e.target.result);
                        $('.file-upload-content').show();
                        $('.image-title').html(input.files[0].name);
                    };
                    reader.readAsDataURL(input.files[0]);
                    init().then(() => {
                        console.log('hello');
                        predict();
                        $('#loading').hide();
                    });
                } else {
                    removeUpload();
                }
            }
            function removeUpload() {
                $('.file-upload-input').replaceWith($('.file-upload-input').clone());
                $('.file-upload-content').hide();
                $('.image-upload-wrap').show();
            }
            $('.image-upload-wrap').bind('dragover', function () {
                $('.image-upload-wrap').addClass('image-dropping');
            });
            $('.image-upload-wrap').bind('dragleave', function () {
                $('.image-upload-wrap').removeClass('image-dropping');
            });
        </script>

        <div id="label-container"></div>
        <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
        <script type="text/javascript">
            // More API functions here:
            // https://github.com/googlecreativelab/teachablemachine-community/tree/master/libraries/image

            // the link to your model provided by Teachable Machine export panel
            const URL = 'https://teachablemachine.withgoogle.com/models/_fHzE_QwB/';

            let model, webcam, labelContainer, maxPredictions;
            // Load the image model and setup the webcam
            async function init() {
                const modelURL = URL + 'model.json';
                const metadataURL = URL + 'metadata.json';

                // load the model and metadata
                // Refer to tmImage.loadFromFiles() in the API to support files from a file picker
                // or files from your local hard drive
                // Note: the pose library adds "tmImage" object to your window (window.tmImage)
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();
                labelContainer = document.getElementById('label-container');
                for (let i = 0; i < maxPredictions; i++) {
                    // and class labels
                    labelContainer.appendChild(document.createElement('div'));
                }
            }

            async function predict() {
                // predict can take in an image, video or canvas html element
                var image = document.getElementById('face-image');
                const prediction = await model.predict(image, false);
                console.log(prediction);
                prediction.sort((a, b) => parseFloat(b.probability) - parseFloat(a.probability));
                console.log(prediction[0].className);

                var resultMessege;
                var resultDescription;
                switch (prediction[0].className) {
                    case 'bad':
                        resultMessege =
                            '대한민국 평균' + '&nbsp' + '40%';
                        resultDescription = '평균 이상이시네요!';
                        break;
                        break;
                    case 'normal':
                        if (prediction[0].probability > 0.8 && prediction[0].probability < 0.9) {
                            resultMessege = '상위' + '&nbsp' + '30%';
                            resultDescription = '훌륭하네요!';
                        } else if (prediction[0].probability > 0.9 && prediction[0].probability < 0.95) {
                            resultMessege = '상위' + '&nbsp' + '25%';
                            resultDescription = '어디서 이쁘다는 말좀 들어보셨겠어요~';
                        } else if (prediction[0].probability > 0.95 && prediction[0].probability < 1) {
                            resultMessege = '상위' + '&nbsp' + '15~20%';
                            resultDescription = '어딜가도 꿇리지 않는 외모!';
                        }
                        break;
                    case 'ugly':
                        resultMessege =
                            '대한민국 평균' + '&nbsp' + '50%';
                        resultDescription = '잘 안나온 사진을 쓰셨나봐요';
                        break;
                    case 'beuty':
                        if (prediction[0].probability > 0.97 && prediction[0].probability < 1) {
                            resultMessege =
                                '상위' +
                                '&nbsp' +
                                ((1 - prediction[0].probability) * 100).toFixed(2) +
                                '%';
                            resultDescription = '말이 되나요 이게??' + '<br>' + '연예인보다도 이쁘시네요!';
                        } else if (prediction[0].probability > 0.95 && prediction[0].probability < 0.97) {
                            resultMessege =
                                '상위' +
                                '&nbsp' +
                                ((1 - prediction[0].probability) * 100).toFixed(2) +
                                '%';
                            resultDescription = '혹시 연예인 아니세요???';
                        } else {
                            resultMessege =
                                '상위' +
                                '&nbsp' +
                                '5%';
                            resultDescription = '배우하셔도 되겠어요~!';
                        }
                        break;

                    default:
                        resultMessege = '알수없음';
                }
                $('.result-messege').html(resultMessege);
                $('.result-descr').html(resultDescription);
            }
        </script>

        <footer class="footer">
            <div class="footer-ada">
                <ins
                    class="kakao_ad_area"
                    style="display: none;"
                    data-ad-unit="DAN-qec48xap1elv"
                    data-ad-width="320"
                    data-ad-height="100"
                ></ins>
            </div>
            <script
                type="text/javascript"
                src="//t1.daumcdn.net/kas/static/ba.min.js"
                async
            ></script>
            <div class="footer-adb">
                <ins
                    class="kakao_ad_area"
                    style="display: none;"
                    data-ad-unit="DAN-1h7gcq8cye980"
                    data-ad-width="320"
                    data-ad-height="50"
                ></ins>
                <script
                    type="text/javascript"
                    src="//t1.daumcdn.net/kas/static/ba.min.js"
                    async
                ></script>
            </div>

            <div class="footer-add">
                <ins
                    class="kakao_ad_area"
                    style="display: none;"
                    data-ad-unit="DAN-1hb7ntx4y1bhh"
                    data-ad-width="300"
                    data-ad-height="250"
                ></ins>
            </div>
            <script
                type="text/javascript"
                src="//t1.daumcdn.net/kas/static/ba.min.js"
                async
            ></script>
            <div class="footer-ade">
                <ins
                    class="kakao_ad_area"
                    style="display: none;"
                    data-ad-unit="DAN-sl3fk20834o5"
                    data-ad-width="250"
                    data-ad-height="250"
                ></ins>
            </div>
            <script
                type="text/javascript"
                src="//t1.daumcdn.net/kas/static/ba.min.js"
                async
            ></script>
        </footer>
    </body>
</html>